
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns="http://www.w3.org/1999/html">
<head>
<meta charset="ISO-8859-1">

<title>Risultati ricerca</title>
</head>

<body>

	<script type="text/javascript" th:inline="javascript">

	var documenti= [[${documenti}]];
	let images= [];
	documenti.forEach(function(name){
	    image = new Image();   // create image
	    image.title= name;
	    image.onload= function (){
	    	//per permettere il caricamento dei media 
	    	console.log("caricato");   // set the src
	    	//window.stop();
	    }
	    image.src = "/documents/" + name + ".jpg";
	    images.push(image);    // push it onto the image array
	});
			
</script>
	<h1>Risultati della ricerca:</h1>
	<span th:text="${hits}" onload="log()"></span>
	<section th:each="risultatoDoc, stat: ${listaRisultati}">
		<h4>
			<a th:href="@{'/toDocumento' + '/' + ${risultatoDoc.titolo}}"
				th:text="${risultatoDoc.titolo}"> titolo</a> <span
				th:text="${risultatoDoc.score}"> Score </span> <span
				th:text="${risultatoDoc.coordinateD}"> </span>

			<ul style="list-style-type: none;">
				<li th:each="coordinata, stat: ${risultatoDoc.boxP}">
					<div>
						<!-- <img th:src="'/documents/' + ${risultatoDoc.titolo} + '.jpg'"
							width="100" height="140"> -->

						<canvas th:id="${stat.index} + ${risultatoDoc.titolo}"
							style="border: 1px solid; width: 1200px; height: 50px;"> your browser doesn't support the canvas tag
							</canvas>

	<script type="text/javascript" th:inline="javascript">

	var titolo= [[${risultatoDoc.titolo}]];   
	var indice= [[${stat.index}]];    
	var box= [[${coordinata}]];    
	var testo= [[${risultatoDoc.coordinateD}]];  
	
	//console.log(testo);
	//console.log(box);
	
	/*riferimento all'elemento html canvas*/
	var canvas= document.getElementById(indice+titolo); 
	
	canvas.width= canvas.scrollWidth;   
	canvas.height= canvas.scrollHeight; 
	/* riferimento al contesto api 2D */
	var ctx = canvas.getContext('2d'); 
	
	var imageCor;
	var imageSel;
	var lunghezza= images.length;
	
	function getImage(){
	for (i = 0; i < lunghezza; i++) {
	  if(images[i].title== titolo){
	  imageSel= images[i];
	  return imageSel;
	 // console.log(images[i].title);
	  }
	}
	}
		
	imageCor= getImage();

	var y= box.y + testo.y;
	var x= testo.x;
	var larghezza= testo.width;
	var altezza= box.height + 5 ; //margine per righe più storte
	console.log("*******************************");
	console.log(x);
	console.log(y);
	console.log(larghezza);
	console.log(altezza);
	console.log("*******************************");
	
	
	//quando ci saranno le righe: se riga è 1, sfasare la y
	ctx.drawImage(imageCor, -(x+90) , -y);
//	imageCor.onload = function (){
		//ctx.drawImage(imageCor, 0, 0);
		//ctx.fillText(imageCor.src);
		
	//ctx.drawImage(imageCor, x, y, larghezza/2, altezza/2, 0, 0, canvas.width, canvas.height ); //,larghezza, altezza );
	//}

	//ctx.drawImage(imageCor, 0, y, larghezza , altezza);
</script>
						<span th:text="${risultatoDoc.titolo}"> nome file </span> <span
							th:text="'|x: '+${coordinata.x} +'|' "> x </span> <span
							th:text="'|y: '+ ${coordinata.y} +'|'"> y </span> <span
							th:text="'|w: '+ ${coordinata.width} +'|'"> w </span> <span
							th:text="'|h: '+ ${coordinata.height} +'|'"> h </span>
					</div>
				</li>
			</ul>
		</h4>
	</section>
	<div>
		<h1>Ritorna alla home:</h1>
		<a href="/home"> home </a>
	</div>
	<script
		src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script type="text/javascript" th:inline="javascript"
		src="/javaScript/apriMedia.js"></script>

</body>
</html>